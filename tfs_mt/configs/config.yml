seed: 42

log_every_iters: 2_000
save_every_iters: 20_000  # Only used for training, testing checkpoints will be saved whenever each epoch ends.
update_pbar_every_iters: 100
checkpoints_retain_n: 5  # The number of checkpoints that will be saved are double the specified number, one half will come from training and the other from testing
time_limit_sec: -1
s3_bucket_name: tfs-mt-checkpoints  # Set to null to disable s3 checkpointing

# If null training will start from scratch
ckpt_path_to_resume_from: null  #s3://bucket-name/path/to/checkpoint.pt or filesystem path

model_base_name: tfs_mt

model_parameters:
  dropout: 0.1

model_configs:
  pretrained_word_embeddings: "GloVe"  # Set to null to disable pretrained embeddings
  positional_embeddings: "sinusoidal"
  nano:
    num_encoder_layers: 4
    num_decoder_layers: 4
    d_model: 50
    num_heads: 4
    d_ff: 200
    # Considered only if pretrained_word_embeddings == "GloVe"
    glove_version: "glove.2024.wikigiga.50d"
    glove_filename: "wiki_giga_2024_50_MFT20_vectors_seed_123_alpha_0.75_eta_0.075_combined"
  small:
    num_encoder_layers: 5
    num_decoder_layers: 5
    d_model: 100
    num_heads: 6
    d_ff: 400
    glove_version: "glove.2024.wikigiga.100d"
    glove_filename: "wiki_giga_2024_100_MFT20_vectors_seed_2024_alpha_0.75_eta_0.05.050_combined"
  base:
    num_encoder_layers: 6
    num_decoder_layers: 6
    d_model: 200
    num_heads: 8
    d_ff: 800
    glove_version: "glove.2024.wikigiga.200d"
    glove_filename: "wiki_giga_2024_200_MFT20_vectors_seed_2024_alpha_0.75_eta_0.05_combined"


training_hp:
  num_epochs: 2
  num_warmup_epochs: 1
  load_checkpoint:
    load_full_checkpoint: False
    load_model_only: False
    load_checkpoint_path: None
  distributed_training: True
  use_amp: True

  loss_type: crossentropy
  loss_label_smoothing: 0.1

  early_stopping_patience: 5

  optimizer_type: adamw
  optimizer_args:
    learning_rate: 5e-2
    weight_decay: 1e-3
    beta1: 0.9
    beta2: 0.999
    eps: 1e-8

tokenizer:
  sos_token: "<s>"
  eos_token: "</s>"
  pad_token: "<PAD>"
  unk_token: "<UNK>"
  max_seq_len: 256
  max_vocab_size: 70_000
  vocab_min_freq: 2
  num_workers: 4

dataset:
  dataset_task: machine-translation
  dataset_id: "Helsinki-NLP/europarl"
  dataset_name: "en-it"
  train_split: 0.8
  src_lang: "en"
  tgt_lang: "it"
  max_len: -1

train_dataloader:
  batch_size: 128
  num_workers: 8
  shuffle: True
  drop_last: True

test_dataloader:
  batch_size: 128
  num_workers: 8
  shuffle: False
  drop_last: False
